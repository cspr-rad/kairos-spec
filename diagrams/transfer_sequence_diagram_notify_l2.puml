@startuml
autoactivate on
actor "Bob :: User" as Bob
participant CasperWallet
box "l2-stack" #LightBlue
participant WebClient
participant ApiServer
participant Database
participant Prover
participant CasperNode
end box
box "on-chain" #LightGreen
participant VerifyTransferSession
participant ValidiumContract
end box

activate CasperNode
activate ApiServer

note over CasperNode, ApiServer
After the deploy gets processed we get notified
end note

CasperNode -> ApiServer: eventHandler(event :: DeployProcessed)
ApiServer -> Database: insert_transfers(Vector<{sender, receiver, amount}>)
Database --> ApiServer: Ok
ApiServer -> WebClient: trigger_refresh
ApiServer --> ApiServer: end eventHandler

WebClient -> ApiServer: GET /balance
ApiServer -> Database: get_balance(user: Bob)
Database --> ApiServer: balance
ApiServer --> WebClient: balance
WebClient -> Bob: notify

@enduml
